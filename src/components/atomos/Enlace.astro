---
interface Props {
  href: string;
  target?: string;
  class?: string;
}
const { href, target = "_self", class: className = "" } = Astro.props;
const isAnchor = href?.startsWith("#");
---
<a
  href={href}
  target={target}
  rel={target === "_blank" ? "noopener noreferrer" : undefined}
  draggable="false"
  class:list={[
    "text-sky-600 hover:text-sky-500 dark:text-sky-400 dark:hover:text-sky-300 underline underline-offset-2 decoration-slate-400 hover:decoration-sky-500 dark:decoration-slate-600 dark:hover:decoration-sky-500 transition-colors",
    className,
  ]}
  data-anchor={isAnchor ? "true" : undefined}
>
  <slot />
</a>

<script is:inline>
  (function() {
    if (typeof window !== "undefined" && window.__smoothScrollAnchorInit) return;
    window.__smoothScrollAnchorInit = true;
    document.addEventListener("click", function(e) {
      var a = e.target.closest("a[data-anchor=\"true\"]");
      if (!a || !a.getAttribute("href")?.startsWith("#")) return;
      e.preventDefault();
      var id = a.getAttribute("href").slice(1);
      var target = document.getElementById(id) || document.getElementsByName(id)[0];
      if (target) {
        var header = document.querySelector("header");
        var offset = header ? header.offsetHeight + 16 : 16;
        var y = target.getBoundingClientRect().top + window.scrollY - offset;
        window.scrollTo({ top: y, behavior: "smooth" });
      }
    });
  })();
</script>
